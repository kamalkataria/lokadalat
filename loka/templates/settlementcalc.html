<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settlement Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Load jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

<!-- Load jsPDF AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>


    <style>
        .settlementForm {
            border: 2px solid #000;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            position: relative;
        }
        .remove-btn {
            position: absolute;
            top: 0;
            right: 0;
            margin: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container border p-4 mt-4">
        <h1 class="text-danger text-center">Add lokadalat settlements</h1>
        <div id="commonFields">
            <div class="row mb-3">
                <div class="col">
                    <label>Bank Name</label>
                    <input type="text" class="form-control" id="bankName">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col">
                    <label>Regional Office</label>
                    <input type="text" class="form-control" id="regionalOffice">
                </div>
                <div class="col">
                    <label>Branch</label>
                    <input type="text" class="form-control" id="branch">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col">
                    <label>Lok Adalat Date</label>
                    <input type="date" class="form-control" id="lokAdalatDate">
                </div>
                <div class="col">
                    <label>Place</label>
                    <input type="text" class="form-control" id="place">
                </div>
            </div>
        </div>
        <div id="formsContainer">
            <form class="settlementForm">
                <button type="button" class="btn btn-danger btn-sm remove-btn" onclick="removeForm(this)">Remove This Form</button>
                <div class="row mb-3">
                    <div class="col">
                        <label>Account Number</label>
                        <input type="number" class="form-control accountNumber">
                    </div>
                    <div class="col">
                        <label>Customer Name</label>
                        <input type="text" class="form-control customerName">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col">
                        <label>Total Closure</label>
                        <input type="number" class="form-control totalClosure" oninput="calculateValues(this)">
                    </div>
                    <div class="col">
                        <label>Outstanding</label>
                        <input type="number" class="form-control outstanding" oninput="calculateValues(this)">
                    </div>
                    <div class="col">
                        <label>Unapplied Interest</label>
                        <input type="number" oninput="calculateValues(this)" class="form-control unappliedInterest" readonly>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col">
                        <label>Compromise Amount</label>
                        <input type="number" class="form-control compromiseAmount" oninput="calculateValues(this)">
                    </div>
                    <div class="col">
                        <label>Token</label>
                        <input type="number" class="form-control token" oninput="calculateValues(this)">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col">
                        <label>Objective</label>
                        <input type="text" class="form-control objective">
                    </div>
                    <div class="col">
                        <label>IRAC</label>
                        <input type="text" class="form-control irac">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col">
                        <label>Waived from Principal</label>
                        <input type="number" oninput="calculateValues(this)" class="form-control prWaived" readonly>
                    </div>
                    <div class="col">
                        <label>Waived from Interest</label>
                        <input type="number" oninput="calculateValues(this)" class="form-control intWaived" readonly>
                    </div>
                    <div class="col">
                        <label>Rest Amount</label>
                        <input type="number" oninput="calculateValues(this)" class="form-control restAmount" readonly>
                    </div>
                </div>
            </form>
        </div>
        <button class="btn btn-primary mt-3" onclick="generateTable()">Submit</button>
        <button class="btn btn-success mt-3 ms-2" onclick="replicateForm()">Add Another Settlement</button>
<!--        <button class="btn btn-danger mt-3 ms-2" onclick="generatePDF()">Download PDF</button>-->
        <div id="settlementTable" class="mt-4"></div>
    </div>
    <script>
        function replicateForm() {
    let formsContainer = document.getElementById("formsContainer");
    let originalForm = document.querySelector(".settlementForm");

    if (!originalForm) {
        console.error("Original form not found!");
        return;
    }

    let newForm = originalForm.cloneNode(true);

    // Clear all input values
    newForm.querySelectorAll("input").forEach(input => {
        if (input.type !== "button") {
            input.value = "";
        }
    });

    // Append the new form
    formsContainer.appendChild(newForm);
}


        function calculateValues(input) {
            let form = input.closest('.settlementForm');
            let totalClosure = parseFloat(form.querySelector('.totalClosure').value) || 0;
            let outstanding = parseFloat(form.querySelector('.outstanding').value) || 0;
            let compromiseAmount = parseFloat(form.querySelector('.compromiseAmount').value) || 0;
            let token = parseFloat(form.querySelector('.token').value) || 0;

            let unappliedInterest = totalClosure - outstanding;
            let restAmount = compromiseAmount - token;
            let prWaived = compromiseAmount > outstanding ? 0 : outstanding - compromiseAmount;
            let intWaived = compromiseAmount > outstanding ? totalClosure - compromiseAmount : unappliedInterest;
            form.querySelector('.unappliedInterest').value = unappliedInterest.toFixed(2);
            form.querySelector('.prWaived').value = prWaived.toFixed(2);
            form.querySelector('.intWaived').value = intWaived.toFixed(2);
            form.querySelector('.restAmount').value = restAmount.toFixed(2);
        }

       function generateTable() {
    let bankName = document.getElementById('bankName').value;
    let regionalOffice = document.getElementById('regionalOffice').value;
    let branch = document.getElementById('branch').value;
    let lokAdalatDate = document.getElementById('lokAdalatDate').value;
    let place = document.getElementById('place').value;

    let table = `<h2 class="text-center">${bankName}</h2>
                 <h3  class="text-center">List of Lok Adalat Settlements held at ${place}</h3>
                 <h4  class="text-center">Branch: ${branch} | Regional Office: ${regionalOffice} | Date: ${lokAdalatDate}</h4>`;

    table += `<table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Account Number</th>
                        <th>Customer Name</th>
                        <th>Total Closure</th>
                        <th>Outstanding</th>
                        <th>Unapplied Interest</th>
                        <th>Compromise Amount</th>
                        <th>Token</th>
                        <th>Waived Principal</th>
                        <th>Waived Interest</th>
                        <th>Rest Amount</th>
                    </tr>
                </thead>
                <tbody>`;

    // Initialize totals
    let totalClosureSum = 0;
    let outstandingSum = 0;
    let unappliedInterestSum = 0;
    let compromiseAmountSum = 0;
    let tokenSum = 0;
    let prWaivedSum = 0;
    let intWaivedSum = 0;
    let restAmountSum = 0;

    document.querySelectorAll('.settlementForm').forEach(form => {
        let totalClosure = parseFloat(form.querySelector('.totalClosure').value) || 0;
        let outstanding = parseFloat(form.querySelector('.outstanding').value) || 0;
        let unappliedInterest = parseFloat(form.querySelector('.unappliedInterest').value) || 0;
        let compromiseAmount = parseFloat(form.querySelector('.compromiseAmount').value) || 0;
        let token = parseFloat(form.querySelector('.token').value) || 0;
        let prWaived = parseFloat(form.querySelector('.prWaived').value) || 0;
        let intWaived = parseFloat(form.querySelector('.intWaived').value) || 0;
        let restAmount = parseFloat(form.querySelector('.restAmount').value) || 0;

        // Sum up values
        totalClosureSum += totalClosure;
        outstandingSum += outstanding;
        unappliedInterestSum += unappliedInterest;
        compromiseAmountSum += compromiseAmount;
        tokenSum += token;
        prWaivedSum += prWaived;
        intWaivedSum += intWaived;
        restAmountSum += restAmount;

        // Append row
        let row = `<tr>
                    <td>${form.querySelector('.accountNumber').value}</td>
                    <td>${form.querySelector('.customerName').value}</td>
                    <td>${totalClosure.toFixed(2)}</td>
                    <td>${outstanding.toFixed(2)}</td>
                    <td>${unappliedInterest.toFixed(2)}</td>
                    <td>${compromiseAmount.toFixed(2)}</td>
                    <td>${token.toFixed(2)}</td>
                    <td>${prWaived.toFixed(2)}</td>
                    <td>${intWaived.toFixed(2)}</td>
                    <td>${restAmount.toFixed(2)}</td>
                </tr>`;
        table += row;
    });

    // Append totals row
    table += `<tr class="table-success font-weight-bold">
                <td colspan="2" class="text-center"><strong>Totals</strong></td>
                <td><strong>${totalClosureSum.toFixed(2)}</strong></td>
                <td><strong>${outstandingSum.toFixed(2)}</strong></td>
                <td><strong>${unappliedInterestSum.toFixed(2)}</strong></td>
                <td><strong>${compromiseAmountSum.toFixed(2)}</strong></td>
                <td><strong>${tokenSum.toFixed(2)}</strong></td>
                <td><strong>${prWaivedSum.toFixed(2)}</strong></td>
                <td><strong>${intWaivedSum.toFixed(2)}</strong></td>
                <td><strong>${restAmountSum.toFixed(2)}</strong></td>
              </tr>`;

    table += '</tbody></table>';
    document.getElementById('settlementTable').innerHTML = table;
}





    </script>
</body>
</html>
